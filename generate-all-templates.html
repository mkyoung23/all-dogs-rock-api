<!DOCTYPE html>
<html>
<head>
    <title>Generate All 20 Template Images - DALL-E 3</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; padding: 20px; background: #f5f5f5; }
        h1 { color: #333; }
        .info { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #2196f3; }
        button { padding: 15px 30px; font-size: 18px; background: #667eea; color: white; border: none; border-radius: 10px; cursor: pointer; margin: 10px 5px; }
        button:hover { background: #5568d3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .progress { margin: 20px 0; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .progress-bar { width: 100%; background: #f0f0f0; border-radius: 10px; height: 30px; overflow: hidden; }
        .progress-fill { width: 0%; background: #667eea; height: 100%; transition: width 0.3s; text-align: center; color: white; line-height: 30px; font-weight: bold; }
        .log { background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 8px; font-family: monospace; font-size: 13px; max-height: 400px; overflow-y: auto; margin: 20px 0; }
        .log-entry { margin: 5px 0; }
        .log-entry.success { color: #4ade80; }
        .log-entry.error { color: #f87171; }
        .log-entry.info { color: #60a5fa; }
        .template { border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; margin: 10px 0; background: white; }
        .template.generating { border-color: #667eea; background: #f0f5ff; }
        .template.success { border-color: #4caf50; background: #f0fff0; }
        .template.error { border-color: #f44336; background: #fff0f0; }
        .template img { max-width: 200px; border-radius: 5px; }
        .url-output { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px; word-break: break-all; }
        #results { display: none; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 20px 0; }
        #jsonOutput { width: 100%; height: 300px; font-family: monospace; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>üé® Generate All 20 Template Images</h1>

    <div class="info">
        <strong>üìù Instructions:</strong> This will generate all 20 iconic pose templates using DALL-E 3 API.<br>
        <strong>‚è±Ô∏è Time:</strong> ~40-60 seconds total (batch generation on server)<br>
        <strong>üí∞ Cost:</strong> ~$0.80 (20 images √ó $0.04 each for DALL-E 3 HD quality)<br>
        <strong>‚úÖ Quality:</strong> Professional HD quality (1024x1024)
    </div>

    <div>
        <button id="startBtn" onclick="generateAllBatch()">üöÄ Start Generating All 20 Templates</button>
        <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
    </div>

    <div class="progress">
        <h3>Generation Progress</h3>
        <div class="progress-bar">
            <div id="progressFill" class="progress-fill">0/20</div>
        </div>
        <div class="log" id="log">
            <div class="log-entry info">Ready to generate template images...</div>
        </div>
    </div>

    <div id="templates"></div>

    <div id="results">
        <h2>‚úÖ All Done! Generated URLs:</h2>
        <textarea id="jsonOutput"></textarea>
        <button onclick="copyJSON()">üìã Copy to Clipboard</button>
        <button onclick="downloadJSON()">üíæ Download JSON</button>
    </div>

    <script>
        const API_ENDPOINT = 'https://all-dogs-rock-api-v2.vercel.app/api/generate-templates';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateProgress(current, total) {
            const percent = Math.round((current / total) * 100);
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percent + '%';
            progressFill.textContent = `${current}/${total}`;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '<div class="log-entry info">Log cleared.</div>';
            updateProgress(0, 20);
        }

        async function generateAllBatch() {
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;

            clearLog();
            log('üöÄ Starting batch generation of all 20 templates...', 'info');
            log(`üì° Calling API: ${API_ENDPOINT}`, 'info');
            log('‚è≥ This will take ~40-60 seconds. Please wait...', 'info');

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        batchMode: true
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (data.success) {
                    log(`‚úÖ ${data.message}`, 'success');

                    // Display results
                    const templatesDiv = document.getElementById('templates');
                    templatesDiv.innerHTML = '';

                    const urlMapping = {};

                    data.results.forEach((result, index) => {
                        const div = document.createElement('div');
                        div.className = `template ${result.success ? 'success' : 'error'}`;

                        if (result.success) {
                            log(`‚úÖ ${result.name}: Generated successfully`, 'success');
                            urlMapping[result.poseId] = result.url;

                            div.innerHTML = `
                                <h3>‚úÖ ${index + 1}. ${result.name}</h3>
                                <img src="${result.url}" alt="${result.name}">
                                <div class="url-output">${result.url}</div>
                            `;
                        } else {
                            log(`‚ùå ${result.name}: ${result.error}`, 'error');
                            div.innerHTML = `
                                <h3>‚ùå ${index + 1}. ${result.name}</h3>
                                <p style="color: #f44336;">Error: ${result.error}</p>
                            `;
                        }

                        templatesDiv.appendChild(div);
                        updateProgress(index + 1, data.results.length);
                    });

                    // Show JSON output
                    const successCount = data.results.filter(r => r.success).length;
                    const failCount = data.results.length - successCount;

                    log('', 'info');
                    log('=== GENERATION COMPLETE ===', 'success');
                    log(`‚úÖ Successful: ${successCount}`, 'success');
                    if (failCount > 0) {
                        log(`‚ùå Failed: ${failCount}`, 'error');
                    }
                    log('üìã Copy the JSON below to update iconic-poses.json', 'info');

                    document.getElementById('jsonOutput').value = JSON.stringify(urlMapping, null, 2);
                    document.getElementById('results').style.display = 'block';

                } else {
                    throw new Error(data.error || 'Unknown error');
                }

            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                alert(`Error: ${error.message}`);
            } finally {
                startBtn.disabled = false;
            }
        }

        function copyJSON() {
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.select();
            document.execCommand('copy');
            log('üìã JSON copied to clipboard!', 'success');
            alert('JSON copied to clipboard!');
        }

        function downloadJSON() {
            const jsonOutput = document.getElementById('jsonOutput').value;
            const blob = new Blob([jsonOutput], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'template-urls.json';
            a.click();
            URL.revokeObjectURL(url);
            log('üíæ JSON downloaded!', 'success');
        }
    </script>
</body>
</html>
