{% comment %}
  T-SHIRT PRODUCT PAGE
  Receives generated dog image via URL parameter
  Allows customer to position/resize image on shirt before purchase
{% endcomment %}

<style>
  .product-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 40px 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .product-header {
    text-align: center;
    padding: 30px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    color: white;
    margin-bottom: 40px;
  }

  .product-header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
  }

  .product-header p {
    font-size: 1.2em;
    opacity: 0.95;
  }

  .product-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    margin-bottom: 40px;
  }

  @media (max-width: 968px) {
    .product-grid {
      grid-template-columns: 1fr;
      gap: 40px;
    }
  }

  .preview-section {
    background: #f8f9ff;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
  }

  .preview-section h2 {
    font-size: 1.8em;
    margin-bottom: 20px;
    color: #333;
  }

  .tshirt-mockup {
    position: relative;
    display: inline-block;
    margin: 20px 0;
    max-width: 500px;
  }

  .tshirt-base {
    width: 100%;
    max-width: 500px;
    filter: drop-shadow(0 20px 40px rgba(0,0,0,0.2));
  }

  .tshirt-design-area {
    position: absolute;
    top: 25%;
    left: 50%;
    transform: translateX(-50%);
    width: 50%;
    height: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #previewCanvas {
    max-width: 100%;
    max-height: 100%;
  }

  .controls-section {
    background: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }

  .controls-section h2 {
    font-size: 1.8em;
    margin-bottom: 30px;
    color: #333;
  }

  .control-group {
    margin-bottom: 30px;
    padding: 25px;
    background: #f8f9ff;
    border-radius: 15px;
  }

  .control-group h3 {
    font-size: 1.3em;
    margin-bottom: 15px;
    color: #667eea;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .control-row {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
  }

  .control-row label {
    font-weight: 600;
    color: #333;
    min-width: 80px;
  }

  .control-row input[type="range"] {
    flex: 1;
    height: 8px;
    border-radius: 5px;
    background: #ddd;
    outline: none;
  }

  .control-row input[type="range"]::-webkit-slider-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #667eea;
    cursor: pointer;
  }

  .control-row input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #667eea;
    cursor: pointer;
  }

  .control-row span {
    min-width: 50px;
    font-weight: 600;
    color: #667eea;
  }

  .size-buttons, .color-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
  }

  .size-btn, .color-btn {
    padding: 15px 20px;
    background: white;
    border: 3px solid #667eea;
    border-radius: 10px;
    font-size: 1.1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    color: #667eea;
  }

  .color-btn {
    min-height: 60px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 5px;
  }

  .color-swatch {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid #ddd;
  }

  .size-btn:hover, .color-btn:hover {
    background: #667eea;
    color: white;
    transform: scale(1.05);
  }

  .size-btn.active, .color-btn.active {
    background: #667eea;
    color: white;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
  }

  .quick-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .btn-action {
    flex: 1;
    min-width: 150px;
    padding: 15px 25px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-action:hover {
    background: #5a6268;
    transform: scale(1.05);
  }

  .price-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 30px;
    border-radius: 15px;
    color: white;
    margin-bottom: 30px;
  }

  .price-section h3 {
    font-size: 1.5em;
    margin-bottom: 15px;
  }

  .price-display {
    font-size: 3em;
    font-weight: 900;
    margin-bottom: 10px;
  }

  .price-details {
    font-size: 1em;
    opacity: 0.9;
  }

  .btn-add-to-cart {
    width: 100%;
    padding: 25px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 1.5em;
    font-weight: 900;
    cursor: pointer;
    transition: all 0.3s;
    margin-bottom: 15px;
  }

  .btn-add-to-cart:hover {
    background: #218838;
    transform: scale(1.02);
    box-shadow: 0 10px 30px rgba(40, 167, 69, 0.4);
  }

  .features-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-top: 40px;
  }

  .feature-card {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    text-align: center;
  }

  .feature-icon {
    font-size: 3em;
    margin-bottom: 15px;
  }

  .feature-card h4 {
    font-size: 1.2em;
    margin-bottom: 10px;
    color: #333;
  }

  .feature-card p {
    color: #666;
    font-size: 0.95em;
  }

  .alert {
    padding: 15px 20px;
    background: #d1ecf1;
    border: 2px solid #0c5460;
    border-radius: 10px;
    color: #0c5460;
    margin-bottom: 20px;
    text-align: center;
    font-weight: 600;
  }
</style>

<div class="product-container">
  <div class="product-header">
    <h1>üëï Custom T-Shirt</h1>
    <p>Your Iconic Dog ‚Ä¢ Premium Cotton ‚Ä¢ Perfect Gift</p>
  </div>

  <div class="alert">
    üëÜ Adjust your design position and size below before adding to cart!
  </div>

  <div class="product-grid">
    <!-- Preview Section -->
    <div class="preview-section">
      <h2>Live Preview</h2>
      <div class="tshirt-mockup">
        <!-- T-shirt SVG with color change -->
        <svg class="tshirt-base" id="tshirtSvg" viewBox="0 0 500 600" xmlns="http://www.w3.org/2000/svg">
          <!-- T-shirt body -->
          <path id="tshirtBody" d="M150,100 L150,550 L350,550 L350,100 L400,80 L450,100 L450,200 L400,180 L400,550 L100,550 L100,180 L50,200 L50,100 L100,80 Z" fill="#000000" stroke="#333" stroke-width="2"/>
          <!-- Neck opening -->
          <ellipse cx="250" cy="100" rx="40" ry="30" fill="#f8f9ff"/>
        </svg>

        <!-- Design area overlay -->
        <div class="tshirt-design-area">
          <canvas id="previewCanvas" width="300" height="300"></canvas>
        </div>
      </div>
      <p style="color: #666; margin-top: 20px;">
        ‚¨ÜÔ∏è This is how your t-shirt will look!
      </p>
    </div>

    <!-- Controls Section -->
    <div class="controls-section">
      <h2>Customize Your T-Shirt</h2>

      <!-- Color Selection -->
      <div class="control-group">
        <h3>üé® T-Shirt Color</h3>
        <div class="color-buttons">
          <button class="color-btn active" onclick="selectColor('Black', '#000000')">
            <div class="color-swatch" style="background: #000000;"></div>
            Black
          </button>
          <button class="color-btn" onclick="selectColor('White', '#FFFFFF')">
            <div class="color-swatch" style="background: #FFFFFF;"></div>
            White
          </button>
          <button class="color-btn" onclick="selectColor('Navy', '#001F3F')">
            <div class="color-swatch" style="background: #001F3F;"></div>
            Navy
          </button>
          <button class="color-btn" onclick="selectColor('Gray', '#AAAAAA')">
            <div class="color-swatch" style="background: #AAAAAA;"></div>
            Gray
          </button>
        </div>
      </div>

      <!-- Size Selection -->
      <div class="control-group">
        <h3>üìè T-Shirt Size</h3>
        <div class="size-buttons">
          <button class="size-btn" onclick="selectSize('S')">S</button>
          <button class="size-btn" onclick="selectSize('M')">M</button>
          <button class="size-btn active" onclick="selectSize('L')">L</button>
          <button class="size-btn" onclick="selectSize('XL')">XL</button>
          <button class="size-btn" onclick="selectSize('2XL')">2XL</button>
        </div>
      </div>

      <!-- Design Position -->
      <div class="control-group">
        <h3>üéØ Design Position</h3>
        <div class="control-row">
          <label>Horizontal:</label>
          <input type="range" id="posX" min="-50" max="50" value="0" oninput="updateImage()">
          <span id="posXValue">0</span>
        </div>
        <div class="control-row">
          <label>Vertical:</label>
          <input type="range" id="posY" min="-50" max="50" value="0" oninput="updateImage()">
          <span id="posYValue">0</span>
        </div>
      </div>

      <!-- Design Size -->
      <div class="control-group">
        <h3>üîç Design Size</h3>
        <div class="control-row">
          <label>Size:</label>
          <input type="range" id="scale" min="50" max="120" value="100" oninput="updateImage()">
          <span id="scaleValue">100%</span>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="control-group">
        <h3>‚ö° Quick Actions</h3>
        <div class="quick-actions">
          <button class="btn-action" onclick="resetImage()">‚Ü∫ Reset</button>
          <button class="btn-action" onclick="centerImage()">‚äï Center</button>
        </div>
      </div>

      <!-- Price & Add to Cart -->
      <div class="price-section">
        <h3>Your Order</h3>
        <div class="price-display">$29.99</div>
        <div class="price-details">
          Size <span id="selectedSize">L</span> ‚Ä¢ <span id="selectedColor">Black</span><br>
          Premium Cotton ‚Ä¢ Free Shipping
        </div>
      </div>

      <button class="btn-add-to-cart" onclick="addToCart()">
        üõí Add to Cart
      </button>

      <button class="btn-action" style="width: 100%;" onclick="goBack()">
        ‚Üê Back to Choose Different Product
      </button>
    </div>
  </div>

  <!-- Features -->
  <div class="features-grid">
    <div class="feature-card">
      <div class="feature-icon">üëï</div>
      <h4>100% Premium Cotton</h4>
      <p>Soft, comfortable, and breathable fabric</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">üé®</div>
      <h4>High-Quality Print</h4>
      <p>Vibrant colors that won't fade or crack</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">üíß</div>
      <h4>Machine Washable</h4>
      <p>Easy care - machine wash cold, tumble dry low</p>
    </div>
    <div class="feature-card">
      <div class="feature-icon">üì¶</div>
      <h4>Free Shipping</h4>
      <p>Ships within 3-5 business days</p>
    </div>
  </div>
</div>

<script>
  // Get image URL from query parameter
  const urlParams = new URLSearchParams(window.location.search);
  const imageUrl = urlParams.get('image');
  const poseId = urlParams.get('pose');

  // Canvas and image settings
  const canvas = document.getElementById('previewCanvas');
  const ctx = canvas.getContext('2d');
  let dogImage = new Image();
  dogImage.crossOrigin = "anonymous";

  // Image state
  let imageState = {
    x: 0,
    y: 0,
    scale: 1.0,
    size: 'L',
    color: 'Black',
    colorHex: '#000000'
  };

  // Load the generated dog image
  if (imageUrl) {
    dogImage.src = imageUrl;
    dogImage.onload = function() {
      updateImage();
    };
  } else {
    // Show placeholder if no image
    ctx.fillStyle = '#f0f0f0';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#666';
    ctx.font = '20px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('No image provided', canvas.width/2, canvas.height/2);
  }

  function updateImage() {
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!dogImage.complete) return;

    // Get control values
    const posX = parseInt(document.getElementById('posX').value);
    const posY = parseInt(document.getElementById('posY').value);
    const scale = parseInt(document.getElementById('scale').value) / 100;

    // Update display values
    document.getElementById('posXValue').textContent = posX;
    document.getElementById('posYValue').textContent = posY;
    document.getElementById('scaleValue').textContent = (scale * 100).toFixed(0) + '%';

    // Update state
    imageState.x = posX;
    imageState.y = posY;
    imageState.scale = scale;

    // Save context
    ctx.save();

    // Move to center
    ctx.translate(canvas.width/2, canvas.height/2);

    // Apply position offset
    ctx.translate(posX, posY);

    // Calculate scaled dimensions (fit to canvas)
    const maxSize = Math.min(canvas.width, canvas.height) * 0.8;
    const imgAspect = dogImage.width / dogImage.height;
    let imgWidth = maxSize * scale;
    let imgHeight = maxSize * scale;

    if (imgAspect > 1) {
      imgHeight = imgWidth / imgAspect;
    } else {
      imgWidth = imgHeight * imgAspect;
    }

    // Draw image centered
    ctx.drawImage(dogImage, -imgWidth/2, -imgHeight/2, imgWidth, imgHeight);

    // Restore context
    ctx.restore();
  }

  function selectColor(colorName, colorHex) {
    imageState.color = colorName;
    imageState.colorHex = colorHex;

    // Update UI
    document.querySelectorAll('.color-btn').forEach(btn => btn.classList.remove('active'));
    event.target.closest('.color-btn').classList.add('active');

    // Change t-shirt color
    document.getElementById('tshirtBody').setAttribute('fill', colorHex);
    document.getElementById('selectedColor').textContent = colorName;
  }

  function selectSize(size) {
    imageState.size = size;

    // Update UI
    document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
    event.target.closest('.size-btn').classList.add('active');

    document.getElementById('selectedSize').textContent = size;
  }

  function resetImage() {
    document.getElementById('posX').value = 0;
    document.getElementById('posY').value = 0;
    document.getElementById('scale').value = 100;
    updateImage();
  }

  function centerImage() {
    document.getElementById('posX').value = 0;
    document.getElementById('posY').value = 0;
    updateImage();
  }

  function addToCart() {
    // Prepare cart data with image settings
    const cartData = {
      imageUrl: imageUrl,
      poseId: poseId,
      size: imageState.size,
      color: imageState.color,
      price: 29.99,
      position: {
        x: imageState.x,
        y: imageState.y,
        scale: imageState.scale
      }
    };

    // Store in session storage for checkout
    sessionStorage.setItem('iconicDogTShirt', JSON.stringify(cartData));

    // Add to Shopify cart
    alert('‚úÖ Added to cart! Settings saved:\n\nSize: ' + imageState.size + '\nColor: ' + imageState.color + '\nPrice: $29.99\n\nProceeding to checkout...');

    // Redirect to cart or checkout
    // window.location.href = '/cart';
  }

  function goBack() {
    window.history.back();
  }
</script>
